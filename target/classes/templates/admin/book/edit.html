<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head >
    <meta charset="UTF-8">
    <title>Edit book</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<header th:insert="~{/admin/fragment/header.html::head}">

</header>
<body>
<div class="container">
    <form id="formEdit">
        <div class="form-group">
            <input type="hidden" class="form-control" name="id" th:value="${book.getId()}">
        </div>
        <div class="form-group">
            <label>Book Name:</label>
            <input type="text" class="form-control" name="name" th:value="${book.getName()}">
        </div>
        <div class="form-group">
            <label>Page Count:</label>
            <input type="text" class="form-control" name="pageCount" th:value="${book.getPageCount()}">
        </div>
        <div class="form-group">
            <label>Point:</label>
            <input type="text" class="form-control" name="point" th:value="${book.getPoint()}">
        </div>
        <div class="form-group">
            <label>Author:</label>
            <select name="authorId">
                <option th:each="item: ${book.getAuthorResponses()}" th:value="${item.getId()}"
                        th:text="${item.getName()}" th:selected="${item.getSelected().equals('selected')}"></option>
            </select>
        </div>
        <div class="form-group">
            <label>Category:</label>
            <input type="checkbox" name="categoryIds" th:each="item2:${book.getCategoryResponses()}"
                   th:value="${item2.getId()}" th:text="${item2.getName()}"
                   th:checked="${item2.getChecked().equals('checked')}">
        </div>
        <span sec:authorize="hasRole('ADMIN')">
            <button type="submit" class="btn btn-primary">Insert Book</button>
        </span>
    </form>
</div>
<script>
    $(document).ready(() => {
        $("#formEdit").submit((e) => {
            e.preventDefault();
            console.log($("#formEdit").serializeArray())
            let data = {}
            let listCategory = [];
            $("#formEdit").serializeArray().forEach(item => {
                if (item.name == "categoryIds")
                    listCategory.push(item.value)
                else
                    data[item.name] = item.value
            })
            data["categoryIds"] = listCategory;
            console.log(data)
            if(confirm("Do you want insert ????")){
                $.ajax({
                    url:"/api/book",
                    method:"post",
                    data:JSON.stringify(data),
                    contentType:"application/json",
                    success:(res)=>{
                        alert("Done !!!")
                        window.location.href="/admin/book/list"
                    },
                    error:(res)=>{
                        alert(res.responseJSON.message);
                    }
                })
            }
        })
    })
</script>
</body>
</html>